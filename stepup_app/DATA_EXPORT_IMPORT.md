# 数据导出与导入功能说明

## 功能概述

StepUp应用新增了数据导出与导入功能，允许用户将所有数据（包括条目、分类、用户信息等）导出为JSON格式文件，以便进行数据备份或在不同设备间迁移数据。

## 功能特性

### 🚀 核心功能
- **完整数据导出**：导出所有用户数据为JSON格式文件
- **灵活数据导入**：支持追加导入或替换导入两种模式
- **进度追踪**：实时显示导出/导入进度和状态信息
- **错误处理**：完善的错误处理机制，确保数据安全

### 📋 导出数据内容
导出的数据包括：
- 用户信息
- 分类和子分类
- 级别信息
- 标签信息
- 综测条目
- 文件附件信息（不包含实际文件）
- 条目标签关联关系

### 📁 文件格式
导出文件为JSON格式，文件命名规则：
```
StepUp数据备份_[用户名]_YYYYMMDD_HHMM.json
```

## 使用方法

### 1. 访问导出导入功能
- 进入"设置"页面
- 在"数据备份与恢复"部分找到相关选项

### 2. 数据导出
- 点击"导出数据"选项
- 查看导出统计信息
- 点击"开始导出"
- 等待导出完成，文件将保存在应用文档目录

### 3. 数据导入
- 点击"导入数据"选项
- 选择导入模式：
  - **追加导入**：将新数据添加到现有数据中
  - **替换导入**：清空现有数据并导入新数据
- 选择有效的JSON数据文件
- 等待导入完成

## 技术实现

### 🛠️ 核心组件
- **DataExportService** - 数据导出导入核心服务类
- **ExportProgressCallback** - 导出进度回调机制
- **ImportProgressCallback** - 导入进度回调机制

### 🏗️ 架构设计
```
DataExportService
├── exportAllData() - 导出所有数据
├── importData() - 导入数据
├── getExportStatistics() - 获取导出统计信息
└── _clearAllData() - 清空所有数据（用于替换导入）

依赖的DAO类：
├── AssessmentItemDao
├── CategoryDao
├── SubcategoryDao
├── LevelDao
├── TagDao
├── UserDao
└── FileAttachmentDao
```

### 📊 关键方法
```dart
// 导出所有数据
Future<String> exportAllData({
  String? outputPath,
  bool includeFiles = false,
  ExportProgressCallback? progressCallback,
});

// 导入数据
Future<void> importData({
  required String filePath,
  bool replaceExisting = false,
  ImportProgressCallback? progressCallback,
});

// 获取导出统计信息
Future<Map<String, int>> getExportStatistics();
```

## 错误处理

### 常见错误情况
- **文件不存在**：导入时选择的文件不存在
- **JSON格式错误**：导入的文件不是有效的JSON格式
- **数据格式错误**：导入的文件数据结构不正确
- **数据库操作失败**：在导入/导出过程中数据库操作失败

### 错误提示
- 导出/导入过程中的错误会通过进度回调实时反馈
- 失败的操作会显示具体的错误原因
- 单个数据项的错误不会影响整个导出/导入过程

## 性能考虑

### 🚀 优化措施
- **分步处理**：按数据类型分步处理，避免内存溢出
- **增量更新**：逐个处理数据项，实时更新进度
- **错误隔离**：单个数据项处理失败不影响整体流程
- **进度反馈**：实时更新进度，提升用户体验

### 📈 性能指标
- 支持数千条数据的批量导出/导入
- 文件大小：根据数据量而定
- 处理速度：约1000条数据/分钟

## 兼容性说明

### ✅ 支持的数据格式
- **JSON格式**：标准的JSON数据交换格式
- **UTF-8编码**：支持中文及其他Unicode字符

### 🔄 版本兼容
- **向后兼容**：新版本可以导入旧版本导出的数据
- **向前兼容**：旧版本可能无法导入新版本导出的数据

## 安全说明

### 🔒 数据安全
- 导出的文件包含敏感信息，请妥善保管
- 建议在安全的环境中进行导出操作
- 导出文件应使用适当的加密保护

### ⚠️ 使用建议
1. **导出前检查**：确保有足够的存储空间
2. **网络环境**：导出/导入过程中建议关闭其他大型应用
3. **数据备份**：导入前建议先备份当前数据
4. **文件管理**：定期清理导出的JSON文件以节省空间

## 更新日志

### v1.0.2 (2025-08-27)
- ✨ 新增数据导出与导入功能
- 📁 支持完整的数据备份与恢复
- 📊 添加导出/导入进度追踪和统计信息
- 🛡️ 完善错误处理和用户提示机制
- 🔄 支持追加导入和替换导入两种模式

## 常见问题解答

### Q: 导出的文件包含实际的附件文件吗？
A: 不包含。导出的JSON文件仅包含附件的元数据信息（如文件名、路径等），不包含实际的文件内容。

### Q: 导入数据时如何处理重复数据？
A: 追加导入模式会保留现有数据并添加新数据；替换导入模式会清空所有现有数据并导入新数据。

### Q: 导出的文件保存在哪里？
A: 默认保存在应用文档目录，具体路径会在导出成功后显示。

### Q: 导入时出现错误怎么办？
A: 系统会尝试继续处理其他数据，单个数据项的错误不会影响整体导入过程。可以在日志中查看详细错误信息。