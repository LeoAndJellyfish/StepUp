# 证明材料导出功能

## 功能概述

新增的"导出所有条目证明材料"功能允许用户将系统中所有条目的证明材料按照条目名称重命名后打包导出为ZIP文件。

## 功能特性

### 🚀 核心功能
- **批量导出**：一键导出所有条目的证明材料
- **智能重命名**：按照条目名称重新组织文件结构
- **格式支持**：支持图片和文档两种类型的证明材料
- **进度追踪**：实时显示导出进度和状态信息

### 📁 文件组织结构
导出的ZIP文件内部结构如下：
```
StepUp证明材料_20241226_1430.zip
├── 数学建模竞赛/
│   ├── 图片_01.jpg
│   ├── 文档_01.pdf
│   └── 条目信息.txt
├── 英语演讲比赛/
│   ├── 图片_01.png
│   ├── 图片_02.jpg
│   └── 条目信息.txt
└── ...
```

### 📋 条目信息文件
每个条目目录下都包含一个`条目信息.txt`文件，包含以下信息：
- 条目名称和描述
- 主分类和子分类信息
- 活动日期和时长
- 获奖情况和参与信息
- 创建和更新时间

## 使用方法

### 1. 访问导出功能
- 进入"综测条目"页面
- 点击右上角的下载图标 📥

### 2. 查看导出信息
系统会显示导出统计信息：
- 总条目数
- 有证明材料的条目数
- 证明材料文件总数

### 3. 执行导出
- 点击"开始导出"按钮
- 观察导出进度条和状态信息
- 等待导出完成

### 4. 获取导出文件
- 导出完成后，ZIP文件保存在应用文档目录
- 系统会显示完整的保存路径
- 文件名格式：`StepUp证明材料_YYYYMMDD_HHMM.zip`

## 技术实现

### 🛠️ 依赖包
- `archive: ^3.4.9` - ZIP文件创建和压缩
- `path_provider` - 获取系统目录路径
- `path` - 文件路径处理

### 🏗️ 架构设计
- **ProofMaterialsExportService** - 核心导出服务类
- **ExportProgressCallback** - 进度回调机制
- **文件安全处理** - 文件名清理和路径验证
- **错误处理机制** - 完善的异常捕获和用户提示

### 📊 关键方法
```dart
// 导出所有证明材料
Future<String> exportAllProofMaterials({
  String? outputPath,
  ExportProgressCallback? progressCallback,
});

// 获取导出统计信息
Future<Map<String, int>> getExportStatistics();
```

## 错误处理

### 常见错误情况
- **无证明材料**：如果没有条目包含证明材料，导出按钮将被禁用
- **文件访问错误**：如果无法访问源文件，会跳过该文件并记录错误
- **磁盘空间不足**：导出过程中会检查磁盘空间
- **权限问题**：确保应用有文件读写权限

### 错误提示
- 导出过程中的错误会通过进度回调实时反馈
- 导出完成后会显示详细的结果信息
- 失败的导出会显示具体的错误原因

## 性能考虑

### 🚀 优化措施
- **临时目录管理**：使用系统临时目录避免磁盘占用
- **增量处理**：逐个处理条目，避免内存溢出
- **自动清理**：导出完成后自动清理临时文件
- **进度反馈**：实时更新进度，提升用户体验

### 📈 性能指标
- 支持数千个条目的批量导出
- 文件大小：根据证明材料大小而定
- 导出速度：约100个条目/分钟（取决于文件大小）

## 兼容性说明

### ✅ 支持的文件格式
**图片格式：**
- JPG/JPEG
- PNG
- GIF
- BMP
- WebP

**文档格式：**
- PDF
- DOC/DOCX
- TXT
- RTF

### 🔄 版本兼容
- **新版本附件**：支持完整的文件附件系统
- **旧版本兼容**：自动处理旧版本的imagePath和filePath字段
- **数据迁移**：无缝支持不同版本的数据格式

## 注意事项

### ⚠️ 使用建议
1. **导出前检查**：确保有足够的磁盘空间
2. **网络环境**：导出过程中建议关闭其他大型应用
3. **数据备份**：导出功能不会影响原始数据
4. **文件管理**：定期清理导出的ZIP文件以节省空间

### 🔒 安全说明
- 导出的文件包含敏感信息，请妥善保管
- 建议在安全的环境中进行导出操作
- 导出文件应使用适当的加密保护

## 更新日志

### v1.0.0 (2024-12-26)
- ✨ 新增证明材料批量导出功能
- 📁 支持按条目名称重新组织文件结构
- 📊 添加导出进度追踪和统计信息
- 🛡️ 完善错误处理和用户提示机制
- 🔄 兼容新旧版本的证明材料存储格式