# 文件删除功能说明

## 功能概述
现在删除评估条目时会**完整删除**所有相关的证明材料文件，确保文件不会残留在系统中。

## 删除流程

### 1. 单个文件附件删除（表单页面中）
当用户点击文件列表中的删除按钮时：
- ✅ 立即删除物理文件
- ✅ 从界面列表中移除

### 2. 评估条目删除（表单页面和列表页面）
当用户删除评估条目时：
- ✅ 获取所有关联的文件附件
- ✅ 逐个删除物理文件
- ✅ 删除数据库中的文件附件记录
- ✅ 清除标签关联
- ✅ 删除评估条目本身

### 3. 编辑条目时的文件替换
当用户编辑评估条目并更新文件时：
- ✅ 获取旧的文件附件
- ✅ 删除旧的物理文件
- ✅ 删除旧的附件记录
- ✅ 保存新的文件附件

## 核心服务

### AssessmentItemDeletionService
专门负责删除相关的服务类，包含以下方法：

1. **deleteAssessmentItem(itemId)** - 完整删除评估条目及所有文件
2. **deleteFileAttachment(attachmentId)** - 删除单个文件附件
3. **deleteMultipleItems(itemIds)** - 批量删除多个条目
4. **cleanupOrphanedFiles()** - 清理孤立文件

## 数据库约束
- file_attachments 表设置了 `ON DELETE CASCADE` 外键约束
- 删除 assessment_item 时会自动删除相关的数据库记录
- 物理文件需要手动删除（由服务处理）

## 用户提示
删除成功后会显示：
> "已删除条目「条目名称」及其所有证明材料"

## 技术要点
1. **文件安全删除** - 使用 FileManager.deleteFile() 安全删除文件
2. **错误处理** - 完整的异常捕获和用户友好的错误提示
3. **事务一致性** - 确保数据库和文件系统的一致性
4. **内存管理** - 删除后正确清理内存引用